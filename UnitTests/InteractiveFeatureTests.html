<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Interactive Feature Tests</title>
    <link rel="stylesheet" type="text/css" href="css/InteractiveFeatureTesting.css">
    

    <!--
    <script src="../js/Listener.js"></script>
    <script src="InteractiveFeatureTests.js"></script>
    -->
    <script src="../js/Feature.js"></script>
    <script src="../js/pubsub.js"></script>

</head>
<body>
    <div class="outputs">
        <div id="STRdiv" class="display">This is my STR div</div>
        <div id="INTdiv" class="display">This is my INT div</div>
        <div id="DEXdiv" class="display">This is my DEX div</div>
        <div id="CONdiv" class="display">This is my CON div</div>
        <div id="WISdiv" class="display">This is my WIS div</div>
        <div id="CHAdiv" class="display">This is my CHA div</div>
    </div>
    
    <div id="pubDisplay">
        <div id="channelDiv" class="inputs">
            <input id="channel" form="text" value='channel'></input>
        </div>
        <div id="keywordDiv" class="inputs">
            <select id="keyword">
                <option value="SelectOne" selected disabled>Select keyword</option>
                <option value="update">update</option>
                <option value="add">add</option>
                <option value="remove">remove</option>
            </input>
        </div>
        <div id="targetDiv" class="inputs">
                <input id="target" form="text" value="target"></input>
        </div>
        <div id="valueDiv" class="inputs">
            <input  id="value" form="text" value="value"></input>
        </div>
        <div id="originDiv" class="inputs">
            <input id="origin" form="text" value="origin"></input>
        </div>
    </div>
    <div class="buttonContainer"><button id="send" value="send">Publish</button></div>
    <div id="feed">Publication feed:</div>

    <script>
        var STR = new Feature({name: 'Strength'});
        STR.update = function() {
            var nSum = 0;
            Object.keys(STR.contributors).forEach(function (sContributor) {
                 nSum += STR.contributors[sContributor];
            });
            document.getElementById("STRdiv").innerHTML = nSum;
        };
        pubsub.subscribe('Strength', function(channel, data) {
            if (data.keyword === "add") {
                STR.contributors[data.origin] = Number(data.value);
            } else if (data.keyword === "remove") {
                delete STR.contributors[data.origin];
            }
            STR.update();
            console.log(STR.contributors);
            pubsub.publish('channel', data);
        });
        pubsub.subscribe('channel', function(channel, data) {
            feed.innerHTML = feed.innerHTML + '<br>' + "channel: " + channel + ". data: " + Object.keys(data);
        });
        
        document.getElementById("send").addEventListener('click', function() {
            var channel = document.getElementById('channel').value,
                keyword = document.getElementById('keyword').value,
                target = document.getElementById('target').value,
                value = document.getElementById('value').value,
                origin = document.getElementById('origin').value,
                data = {keyword: keyword, target: target, value: value, origin: origin};
            pubsub.publish(channel, data);
        });
    </script>
</body>
</html>